<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ivoplayx Chat (debug)</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/tmi.js@1.8.5/dist/tmi.min.js"></script>
</head>
<body>
  <div id="chat"></div>
  <div id="log"></div> <!-- mostrarÃ¡ errores o estado -->

  <script>
    const log = (msg) => {
      const logBox = document.getElementById('log');
      const p = document.createElement('p');
      p.textContent = msg;
      logBox.appendChild(p);
      console.log(msg);
    };

    log('ðŸŸ¡ Conectando con Twitch...');

    const client = new tmi.Client({
      options: { debug: true },
      connection: { reconnect: true },
      channels: ['ivoplayx'] // asegÃºrate de que es tu canal
    });

    client.connect()
      .then(() => log('âœ… ConexiÃ³n establecida con Twitch'))
      .catch(err => log('âŒ Error de conexiÃ³n: ' + err));

    client.on('message', (channel, tags, message, self) => {
      if (self) return;
      log(`ðŸ’¬ Mensaje recibido de ${tags['display-name']}: ${message}`);
      addMessage(tags['display-name'], message);
    });

    client.on('connected', () => log('ðŸŸ¢ Conectado al servidor IRC de Twitch'));
    client.on('disconnected', () => log('ðŸ”´ Desconectado del servidor'));

    function addMessage(username, message) {
      const chat = document.getElementById('chat');
      const msgContainer = document.createElement('div');
      msgContainer.classList.add('message');

      const index = chat.children.length % 2;
      msgContainer.classList.add(index === 0 ? 'dark' : 'darker');

      const user = document.createElement('span');
      user.classList.add('username');
      user.textContent = username + ': ';

      const text = document.createElement('span');
      text.classList.add('text');
      text.textContent = message;

      msgContainer.appendChild(user);
      msgContainer.appendChild(text);
      chat.appendChild(msgContainer);

      if (chat.children.length > 20) {
        chat.removeChild(chat.firstChild);
      }

      chat.scrollTop = chat.scrollHeight;
    }
  </script>
</body>
</html>
